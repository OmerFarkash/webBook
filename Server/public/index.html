
<!-- this is a test helper to check if every address response as it should
	before we connect the server to the client side -->

<!-- this test need adaptetions for the spesific method you are
	 testing so make sure it has the correct labels + inputs -->

<!-- downloading mongoDBCompss is a must for working with the server and checking it -->

<!doctype html>
<html>
	<head>
		<title>FooBar Backend Test Page</title>
		<style>
			body {
				background: #51d1cb;
			}
			form {
				margin: 1em 0;
				padding: 0.5em;
				border: solid 1px black
			}
			form label {
				display: block;
				margin: 0.25em;
			}
			#token-form {
				background: #48df82;
				outline: solid 1em #51d1cb;
				position: fixed;
				right: 1em;
			}
			h3, h4 {
				margin: 0;
			}
		</style>
	</head>
	<body>
		<form id="token-form">
			<h4>Global Settings</h2>
			<label>jwtToken: <input id="jwt-token" size="100"></label>
			<label>id (user id): <input id="uid" size="50"></label>
			<label>pid (post id): <input id="pid" size="50"></label>
			<label>fid (friend id): <input id="fid" size="50"></label>
		</form>
		
		<!-- can use -->
		<form id="user-create" data-method="POST" action="http://localhost:$port/api/users/">
			<h3>Register</h3>
			<label>name: <input name="name"></label>
			<label>username: <input name="username"></label>
			<label>password: <input name="password"></label>
			<label>profilePic (Base 64): <input name="profilePic"></label>
			<button type="submit">Submit</button>
		</form>

		<!-- edit to our versition -->
		<form id="tokens" data-method="POST" action="http://localhost:$port/api/tokens/">
			<h3>Log in</h3>
			<label>username: <input name="username"></label>
			<label>password: <input name="password"></label>
			<button type="submit">Submit</button>
		</form>

		<!-- edit to our versition -->
		<form id="feed" data-method="GET" action="http://localhost:$port/api/posts/">
			<h3>Get Feed</h3>
			<button type="submit">Submit</button>
		</form>

		<!-- can use -->
		<form id="user-get" data-method="GET" action="http://localhost:$port/api/users/$uid/">
			<h3>Get User Details</h3>
			<button type="submit">Submit</button>
		</form>
		
		<!-- can use -->
		<form id="user-patch" data-method="PATCH" action="http://localhost:$port/api/users/$uid/">
			<h3>Get User Details PATCH</h3>
			<label>new username: <input name="username"></label>
			<label>new profilePic: <input name="profilePic"></label>
			<button type="submit">Submit</button>
		</form>

		<!-- can use -->
		<form id="user-put" data-method="PUT" action="http://localhost:$port/api/users/$uid/">
			<h3>Get User Details PUT</h3>
			<label>new username: <input name="username"></label>
			<label>new profilePic: <input name="profilePic"></label>
			<button type="submit">Submit</button>
		</form>

		<!-- edit to our versition -->
		<form id="user-delete" data-method="DELETE" action="http://localhost:$port/api/users/$uid/">
			<h3>Delete User</h3>
			<button type="submit">Submit</button>
		</form>

		<!-- edit to our versition -->
		<form id="posts-get-own" data-method="GET" action="http://localhost:$port/api/users/$uid/posts/">
			<h3>Get User's Posts</h3>
			<button type="submit">Submit</button>
		</form>

		<!--  can use --> 
		<form id="posts-create" data-method="POST" action="http://localhost:$port/api/users/$uid/posts/">
			<h3>Create post</h3>
			<label>desc: <input name="desc"></label>
			<label>postPic: <input name="postPic"></label>
			<button type="submit">Submit</button>
		</form>

		<!--  can use --> 
		<form id="likes" data-method="POST" action="http://localhost:$port/api/posts/$pid/likes/">
			<h3>likes</h3>
			<button type="submit">Submit</button>
		</form>

		<!-- can use -->
		<form id="post-edit-patch" data-method="PATCH" action="http://localhost:$port/api/users/$uid/posts/$pid">
			<h3>Edit Post (PATCH)</h3>
			<label>desc: <input name="desc"></label>
			<label>postPic: <input name="postPic"></label>
			<button type="submit">Submit</button>
		</form>

		<!-- can use -->
		<form id="post-edit-put" data-method="PUT" action="http://localhost:$port/api/users/$uid/posts/$pid">
			<h3>Edit Post (PUT)</h3>
			<label>desc: <input name="desc"></label>
			<label>postPic: <input name="postPic"></label>
			<button type="submit">Submit</button>
		</form>

		<!-- can use -->
		<form id="post-delete" data-method="DELETE" action="http://localhost:$port/api/users/$uid/posts/$pid">
			<h3>Delete Post</h3>
			<button type="submit">Submit</button>
		</form>

		<!-- edit to our versition -->
		<form id="friends-get" data-method="GET" action="http://localhost:$port/api/users/$uid/friends">
			<h3>Get Friends List</h3>
			<button type="submit">Submit</button>
		</form>

		<!-- can use -->
		<form id="friends-post" data-method="POST" action="http://localhost:$port/api/users/$fid/friends/">
			<h3>Post Friend Request</h3>
			<p>Posts a friend request from id to fid</p>
			<button type="submit">Submit</button>
		</form>

		<!-- can use -->
		<form id="friends-fid-patch" data-method="PATCH" action="http://localhost:$port/api/users/$uid/friends/$fid">
			<h3>Approve friend request</h3>
			<p>id approves the request from fid</p>
			<button type="submit">Submit</button>
		</form>

		<!-- edit to our versition -->
		<form id="friends-fid-delete" data-method="DELETE" action="http://localhost:$port/api/users/$uid/friends/$fid">
			<h3>Delete friend or friend request</h3>
			<p>id removes fid from their friends list; if fid is waiting for id to approve a friend request, this will deny the request</p>
			<button type="submit">Submit</button>
		</form>

		<script>
const els = {
	fid: document.querySelector('#fid'),
	jwtToken: document.querySelector('#jwt-token'),
	pid: document.querySelector('#pid'),
	uid: document.querySelector('#uid'),

	userCreate: document.querySelector('#user-create'),

	tokens: document.querySelector('#tokens'),

	feed: document.querySelector('#feed'),

	userDelete: document.querySelector('#user-delete'),
	userGet: document.querySelector('#user-get'),
	userPatch: document.querySelector('#user-patch'),
	userPut: document.querySelector('#user-put'),

	likes: document.querySelector('#likes'),

	postsCreate: document.querySelector('#posts-create'),
	postsGetOwn: document.querySelector('#posts-get-own'),

	postDelete: document.querySelector('#post-delete'),
	postEditPatch: document.querySelector('#post-edit-patch'),
	postEditPut: document.querySelector('#post-edit-put'),

	friendsGet: document.querySelector('#friends-get'),
	friendsPost: document.querySelector('#friends-post'),

	friendsFidDelete: document.querySelector('#friends-fid-delete'),
	friendsFidPatch: document.querySelector('#friends-fid-patch'),
}

/* Initialization */

const DEFAULT_FRIEND_ID = 'roni' // default for :fid
const DEFAULT_JWT = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im9tZXIiLCJwYXNzd29yZCI6InBhc3N3b3JkIiwiaWF0IjoxNzEzNDUyMTU0fQ.mqD2DOvLDAsGpV-4HZC_8jdrXhq_-V10r0ouK_TacJc' // Has to be the JWT of :id
const DEFAULT_PORT = 12345
const DEFAULT_POST_ID = '661ff71fd86e42fad3c2e24e' // default for :pid
const DEFAULT_USER_ID = 'omer' // default for :id

els.fid.value = DEFAULT_FRIEND_ID
els.jwtToken.value = DEFAULT_JWT
els.pid.value = DEFAULT_POST_ID
els.uid.value = DEFAULT_USER_ID
document.querySelectorAll('form').forEach(form => form.action = form.action.replace("$port", DEFAULT_PORT))

/* End of initialization */

const onSubmit = el =>
	el.addEventListener('submit', e => { e.preventDefault(); sendForm(el) })

const sendForm = form => {
	const method = form.dataset.method
	const url = form.action
		.replace("$uid", els.uid.value)
		.replace("$pid", els.pid.value)
		.replace("$fid", els.fid.value)
	const body = method === 'GET' ? {} : { body: JSON.stringify(Object.fromEntries(new FormData(form))) }

	return fetch(url, Object.assign({
		method: method,
		headers: {
			'Authorization': 'Bearer ' + els.jwtToken.value,
			'Content-Type': 'application/json',
		},
	}, body)).then(async res => {
		try { console.log(await res.json()) } catch (e) { console.log(res) }
	})
}

[ els.userCreate, els.tokens, els.feed, els.userDelete, els.userGet, els.userPatch, els.userPut, els.likes, els.postsCreate,
	els.postsGetOwn, els.postDelete, els.postEditPatch, els.postEditPut, els.friendsGet,
	els.friendsPost, els.friendsFidDelete, els.friendsFidPatch, ]
	.forEach(onSubmit)
		</script>
	</body>
</html>
